import{z as P,r as b,M as j,j as e,Q as A,C as n,e as i,f as o,g as c,v as z,h as u,B as x,q as D,Y as F,Z as p,k as N,au as E}from"./index-BvjW9mvP.js";import{I as U}from"./input-kFU0mmdx.js";import{U as M}from"./upload-6VQWtmj1.js";import{T as k}from"./triangle-alert-CG4a9bpy.js";function L(){const{toast:d}=P(),[l,v]=b.useState(null),[B,f]=b.useState(null),s=j({mutationFn:a=>p("/api/fridge/vision",{method:"POST",body:{imageBase64:a,detectionMode:"detailed"}}),onSuccess:()=>{d({title:"Análisis Completado",description:"Tu nevera ha sido analizada. ¡Revisa las recetas anti-desperdicio!"})},onError:()=>{d({title:"Error en el Análisis",description:"No se pudo procesar la imagen. Inténtalo de nuevo.",variant:"destructive"})}}),r=j({mutationFn:a=>p("/api/fridge/weekly-rescue",{method:"POST",body:{detectedIngredients:a,servings:2,daysToGenerate:7}}),onSuccess:()=>{d({title:"Plan Semanal Creado",description:"Tu plan anti-desperdicio para toda la semana está listo."})}}),y=a=>{var h;const t=(h=a.target.files)==null?void 0:h[0];if(t){f(t);const m=new FileReader;m.onload=R=>{var g;const I=(g=R.target)==null?void 0:g.result;v(I)},m.readAsDataURL(t)}},w=async()=>{if(!l)return;const a=l.split(",")[1];s.mutate(a)},C=()=>{var a,t;(t=(a=s.data)==null?void 0:a.detection)!=null&&t.ingredients&&r.mutate(s.data.detection.ingredients)},T=a=>{switch(a){case"fresh":return"bg-green-500/20 text-green-400 border-green-500/30";case"good":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"near_expiry":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"expired":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},S=a=>{switch(a){case"fresh":return e.jsx(E,{className:"w-4 h-4"});case"good":return e.jsx(N,{className:"w-4 h-4"});case"near_expiry":return e.jsx(k,{className:"w-4 h-4"});case"expired":return e.jsx(k,{className:"w-4 h-4"});default:return e.jsx(N,{className:"w-4 h-4"})}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-dark-green via-black to-dark-green p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(A,{className:"w-10 h-10 text-chalk-green"}),e.jsx("h1",{className:"text-4xl font-bold text-chalk-white",children:"Vision Nevera 2.0"})]}),e.jsx("p",{className:"text-chalk/70 text-lg",children:"Detecta ingredientes, fechas de caducidad y genera recetas anti-desperdicio"})]}),e.jsxs(n,{className:"glass-container border-chalk-green/30 mb-6",children:[e.jsx(i,{children:e.jsxs(o,{className:"text-chalk-white flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Analizar Tu Nevera"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"image-upload",className:"text-chalk mb-2 block",children:"Sube una foto de tu nevera o despensa"}),e.jsx(U,{id:"image-upload",type:"file",accept:"image/*",onChange:y,className:"text-chalk border-chalk-green/30"})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:l,alt:"Imagen de nevera",className:"w-full max-h-64 object-cover rounded-lg border border-chalk-green/30"})}),e.jsx(u,{onClick:w,disabled:s.isPending,className:"w-full bg-chalk-green text-dark-green hover:bg-chalk-green/80",children:s.isPending?"Analizando...":"Analizar Ingredientes"})]})]})]}),s.data&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{className:"glass-container border-chalk-green/30 mb-6",children:[e.jsx(i,{children:e.jsx(o,{className:"text-chalk-white",children:"Ingredientes Detectados"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsx("div",{className:"text-2xl font-bold text-chalk-green",children:s.data.detection.totalDetected}),e.jsx("div",{className:"text-chalk/60",children:"Total detectados"})]}),e.jsxs("div",{className:"text-center p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:s.data.detection.expiringCount}),e.jsx("div",{className:"text-chalk/60",children:"Por caducar"})]}),e.jsxs("div",{className:"text-center p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsx("div",{className:"text-2xl font-bold text-chalk-green",children:s.data.recipes.totalRecipes}),e.jsx("div",{className:"text-chalk/60",children:"Recetas sugeridas"})]}),e.jsxs("div",{className:"text-center p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsx("div",{className:"text-sm font-bold text-chalk-green",children:s.data.detection.processingTime}),e.jsx("div",{className:"text-chalk/60",children:"Tiempo análisis"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.data.detection.ingredients.map((a,t)=>e.jsxs("div",{className:"p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-chalk-white",children:a.name}),e.jsxs(x,{className:`${T(a.condition)} border`,children:[S(a.condition),e.jsx("span",{className:"ml-1 capitalize",children:a.condition})]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-chalk/60",children:[e.jsxs("div",{children:["Peso: ",a.estimatedWeight]}),e.jsxs("div",{children:["Caduca: ",a.estimatedExpiryDate]}),e.jsxs("div",{children:["En ",a.expiryDays," días"]}),e.jsxs("div",{children:["Confianza: ",a.confidence.toFixed(0),"%"]})]})]},t))})]})]}),s.data.recipes.antiWaste.length>0&&e.jsxs(n,{className:"glass-container border-chalk-green/30 mb-6",children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"text-chalk-white flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Recetas Anti-Desperdicio"]}),e.jsx(x,{className:"bg-chalk-green text-dark-green",children:"5 recetas generadas"})]})}),e.jsx(c,{children:e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.data.recipes.antiWaste.map((a,t)=>e.jsxs("div",{className:"p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-chalk-white",children:a.name}),e.jsxs(x,{variant:"outline",className:"text-chalk-green border-chalk-green/30",children:[a.cookingTime,"min"]})]}),e.jsx("p",{className:"text-sm text-chalk/60 mb-3",children:a.description}),e.jsx("div",{className:"text-xs text-chalk-green mb-2",children:a.wasteReduction}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-chalk/60",children:[e.jsxs("span",{children:["Dificultad: ",a.difficulty]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Score: ",a.expiryScore,"/5"]})]})]},t))})})]}),e.jsx(n,{className:"glass-container border-chalk-green/30",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-8 h-8 text-chalk-green"}),e.jsx("h2",{className:"text-2xl font-bold text-chalk-white",children:"Plan Semanal Anti-Desperdicio"})]}),e.jsx("p",{className:"text-chalk/60",children:"Usa todos estos ingredientes durante toda la semana con un plan personalizado"}),e.jsx(u,{onClick:C,disabled:r.isPending,className:"bg-chalk-green text-dark-green hover:bg-chalk-green/80 px-8 py-6 text-lg",children:r.isPending?"Generando...":"Usar Restos Toda la Semana"}),r.data&&e.jsxs("div",{className:"mt-4 p-4 bg-black/20 rounded-lg border border-chalk-green/20",children:[e.jsx("div",{className:"text-chalk-green font-medium",children:"Plan Semanal Creado"}),e.jsx("div",{className:"text-sm text-chalk/60 mt-1",children:r.data.plan})]})]})})})]})]})})}export{L as default};
